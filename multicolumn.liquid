{%- comment -%}
- Shopify Native Section, which was updated with functions based on PageFly
- Code change was primarily to inject the option for Add to Cart Button, Section Button Add to Cart, Image text overlay and border around boxes
- Added radius to corners as an option
{%- endcomment -%}		


{{ 'section-multicolumn.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-product-form.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
  .multicolumn-card {
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  .multicolumn-card__info {
    flex-grow: 1;
    padding: 2.5rem;
  }
  .multicolumn-card .product-form,
  .multicolumn-section-buy-button {
    margin-top: 1.5rem;
  }
  .multicolumn-section-buy-button {
    display: flex;
    justify-content: center;
  }

  /* --- Styles for Text Overlay --- */
  .multicolumn-card--overlay {
    position: relative; /* Container for the text */
  }
  .multicolumn-card--overlay .multicolumn-card__image {
    opacity: 0.9; /* Darken image for readability */
  }
  .multicolumn-card--overlay .multicolumn-card__info {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 1.5rem;
    background: transparent;
    color: white;
    text-align: center;
  }
  .multicolumn-card--overlay .multicolumn-card__info * {
    color: white !important;
  }
{%- endstyle -%}

{%- liquid
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif
-%}

<div class="multicolumn color-{{ section.settings.color_scheme }} gradient">
  <div
    class="page-width section-{{ section.id }}-padding isolate"
  >
    {%- unless section.settings.title == blank -%}
      <div class="title-wrapper-with-link title-wrapper--self-padded-mobile title-wrapper--no-top-margin multicolumn__title center">
        <h2 class="title inline-richtext {{ section.settings.heading_size }}">
          {{ section.settings.title }}
        </h2>
      </div>
    {%- endunless -%}
    <slider-component class="slider-mobile-gutter">
      <ul
        class="multicolumn-list contains-content-container grid grid--{{ section.settings.columns_mobile }}-col-tablet-down grid--{{ section.settings.columns_desktop }}-col-desktop{% if show_mobile_slider %} slider slider--tablet grid--peek{% endif %}"
        id="Slider-{{ section.id }}"
        role="list"
      >
        {%- liquid
          assign highest_ratio = 0
          for block in section.blocks
            if block.settings.image.aspect_ratio > highest_ratio
              assign highest_ratio = block.settings.image.aspect_ratio
            endif
          endfor
        -%}
        {%- for block in section.blocks -%}
          <li
            id="Slide-{{ section.id }}-{{ forloop.index }}"
            class="multicolumn-list__item grid__item{% if section.settings.swipe_on_mobile %} slider__slide{% endif %}{% if section.settings.column_alignment == 'center' %} center{% endif %}"
            {{ block.shopify_attributes }}
          >
            <div class="multicolumn-card content-container {% if section.settings.text_overlay %} multicolumn-card--overlay{% endif %}">
              {%- if block.settings.image != blank -%}
                <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--{{ section.settings.image_width }}-width">
                  <div
                    class="media media--transparent media--{{ section.settings.image_ratio }}"
                    {% if section.settings.image_ratio == 'adapt' and highest_ratio != 0 %}
                      style="padding-bottom: {{ 1 | divided_by: highest_ratio | times: 100 }}%;"
                    {% endif %}
                  >
                    {%- liquid
                      assign number_of_columns = section.settings.columns_desktop
                      assign image_width_class = section.settings.image_width
                      if image_width_class == 'full'
                         assign image_width_multiplier = 1.0
                      elsif image_width_class == 'half'
                         assign image_width_multiplier = 0.5
                      else
                         assign image_width_multiplier = 0.33
                      endif
                      assign sizes = number_of_columns | times: image_width_multiplier
                    -%}
                    {{
                      block.settings.image
                      | image_url: width: 3200
                      | image_tag:
                        widths: '50, 75, 100, 150, 200, 300, 400, 500, 750, 1000, 1250, 1500, 1750, 2000, 2250, 2500, 2750, 3000, 3200',
                        sizes: sizes,
                        class: 'multicolumn-card__image'
                    }}
                  </div>
                </div>
              {%- endif -%}

              <div class="multicolumn-card__info">
                {%- if block.settings.title != blank -%}
                  <h3 class="inline-richtext">{{ block.settings.title }}</h3>
                {%- endif -%}
                {%- if block.settings.text != blank -%}
                  <div class="rte">{{ block.settings.text }}</div>
                {%- endif -%}
                {%- if block.settings.link_label != blank -%}
                  <a class="link animate-arrow" href="{{ block.settings.link }}">
                    {{- block.settings.link_label | escape -}}
                    <span class="icon-wrap">&nbsp;{% render 'icon-arrow' %}</span>
                  </a>
                {%- endif -%}
                {%- if block.settings.product != blank -%}
                  {%- assign product = block.settings.product -%}
                  <product-form class="product-form">
                    <form method="post" action="/cart/add" id="product-form-{{ section.id }}-{{ block.id }}" class="form">
                      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                      <div class="product-form__buttons">
                        <button type="submit" name="add" class="product-form__submit button button--full-width button--primary">
                          <span>{{ block.settings.button_text | default: 'Add to cart' }}</span>
                        </button>
                      </div>
                    </form>
                  </product-form>
                {%- endif -%}
              </div>
            </div>
          </li>
        {%- endfor -%}
      </ul>
    </slider-component>
    <div class="multicolumn-section-buy-button center">
      {%- if section.settings.section_product != blank -%}
        {%- assign product = section.settings.section_product -%}
        <product-form class="product-form">
          <form method="post" action="/cart/add" id="product-form-{{ section.id }}" class="form">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <div class="product-form__buttons">
              <button type="submit" name="add" class="product-form__submit button button--primary">
                <span>{{ section.settings.button_label | default: 'Add to cart' }}</span>
              </button>
            </div>
          </form>
        </product-form>
      {%- elsif section.settings.button_label != blank -%}
        <a class="button button--primary" href="{{ section.settings.button_link }}">
          {{ section.settings.button_label | escape }}
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Multicolumn",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "inline_richtext", "id": "title", "default": "Multicolumn", "label": "Heading" },
    { "type": "select", "id": "heading_size", "options": [ { "value": "h2", "label": "Small" }, { "value": "h1", "label": "Medium" }, { "value": "h0", "label": "Large" } ], "default": "h1", "label": "Heading size" },
    { "type": "select", "id": "image_width", "options": [ { "value": "third", "label": "Third" }, { "value": "half", "label": "Half" }, { "value": "full", "label": "Full width of column" } ], "default": "full", "label": "Image width" },
    { "type": "select", "id": "image_ratio", "options": [ { "value": "adapt", "label": "Adapt to image" }, { "value": "portrait", "label": "Portrait" }, { "value": "square", "label": "Square" } ], "default": "adapt", "label": "Image ratio" },
    { "type": "range", "id": "columns_desktop", "min": 1, "max": 6, "step": 1, "default": 3, "label": "Number of columns on desktop" },
    { "type": "select", "id": "column_alignment", "options": [ { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" } ], "default": "left", "label": "Column alignment" },
    { "type": "checkbox", "id": "text_overlay", "label": "Overlay text and button on image", "default": false },
    { "type": "checkbox", "id": "enable_column_borders", "label": "Show border around each column", "default": false },
    { "type": "select", "id": "background_style", "options": [ { "value": "none", "label": "None" }, { "value": "primary", "label": "Primary" } ], "default": "primary", "label": "Secondary background" },
    { "type": "header", "content": "Section Button" },
    { "type": "product", "id": "section_product", "label": "Buy button product" },
    { "type": "text", "id": "button_label", "label": "Button label" },
    { "type": "url", "id": "button_link", "label": "Button link" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },
    { "type": "header", "content": "Mobile Layout" },
    { "type": "select", "id": "columns_mobile", "options": [ { "value": "1", "label": "1 column" }, { "value": "2", "label": "2 columns" } ], "default": "1", "label": "Number of columns on mobile" },
    { "type": "checkbox", "id": "swipe_on_mobile", "default": false, "label": "Enable swipe on mobile" },
    { "type": "header", "content": "Section Padding" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top padding", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom padding", "default": 36 }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "inline_richtext", "id": "title", "label": "Heading" },
        { "type": "richtext", "id": "text", "label": "Description" },
        { "type": "text", "id": "link_label", "label": "Link label" },
        { "type": "url", "id": "link", "label": "Link" },
        { "type": "header", "content": "Add to Cart Button" },
        { "type": "product", "id": "product", "label": "Product" },
        { "type": "text", "id": "button_text", "label": "Button text", "default": "Add to cart" }
      ]
    }
  ],
  "presets": [
    { "name": "Multicolumn", "blocks": [ { "type": "column" }, { "type": "column" }, { "type": "column" } ] }
  ]
}
{% endschema %}
