"{%- comment -%}
- Shopify Native Section, which was updated with the ability to add a buy button and a border 
- Updated store front functionality has been added to allow for an image to be contained within the image section or cover, which zooms the photo in to fill the whole image container. 
- Left note within the style section of code for how to change border weight. 
- All custom css for these sections is within the GitHub file titled front-end-custom-css 
- V3: updated to fix the issue that the app Yagi created by injecting its hard code into the functionality of the website. Added AJAX functionality
to ensure that this section will remain independent from other apps in the future. 
WARNING NOTE: Please be aware of the coding implications of apps for the website's functionality. This issue only happened due to the 
choice of using Yagi. There are developer tools on all apps that explain the potential consequences of adding an app to your store.
You should familiarise yourself with them prior to adding an app to avoid a delay in service. 
{%- endcomment -%}"					
					

{{ 'component-image-with-text.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-product-form.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .image-with-text--boxed {
    border: 2.5px solid rgba(var(--color-foreground), 0.2);
    border-radius: 1.5rem;
    padding: 2.5rem;
  }

  @media screen and (min-width: 750px) {
    .image-with-text--boxed {
      padding: 5rem;
    }
  }

  .section-{{ section.id }}-padding .image-with-text__media img {
     object-fit: {{ section.settings.image_fit }};
  }

  .image-with-text__content .quick-add-button-wrapper {
    margin-top: 3rem;
  }

  /* Loading Spinner Styles */
  .loading-overlay__spinner {
    width: 1.8rem;
    display: inline-block;
  }
  .spinner {
    animation: rotator 1.4s linear infinite;
  }
  @keyframes rotator {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(270deg); }
  }
  .path {
    stroke-dasharray: 280;
    stroke-dashoffset: 0;
    transform-origin: center;
    stroke: currentColor;
    animation: dash 1.4s ease-in-out infinite;
  }
  @keyframes dash {
    0% { stroke-dashoffset: 280; }
    50% { stroke-dashoffset: 75; transform: rotate(135deg); }
    100% { stroke-dashoffset: 280; transform: rotate(450deg); }
  }
  .hidden {
    display: none !important;
  }
{%- endstyle -%}

{%- liquid
  assign fetch_priority = 'auto'
  if section.index == 1
    assign fetch_priority = 'high'
  endif

  assign remove_color_classes = false
  if section.settings.color_scheme == section.settings.section_color_scheme and section.settings.content_layout == 'no-overlap' and section.settings.enable_border_box == false
    assign remove_color_classes = true
  endif
-%}

<div class="section-{{ section.id }}-padding gradient color-{{ section.settings.section_color_scheme }}">
  <div class="page-width">
    <div class="image-with-text image-with-text--{{ section.settings.content_layout }} isolate{% if section.settings.enable_border_box %} image-with-text--boxed color-{{ section.settings.color_scheme }}{% endif %}">
      <div class="image-with-text__grid grid grid--gapless grid--1-col grid--{% if section.settings.desktop_image_width == 'medium' %}2-col-tablet{% else %}3-col-tablet{% endif %}{% if section.settings.layout == 'text_first' %} image-with-text__grid--reverse{% endif %}">
        <div class="image-with-text__media-item image-with-text__media-item--{{ section.settings.desktop_image_width }} image-with-text__media-item--{{ section.settings.desktop_content_position }} grid__item">
          <div
            class="image-with-text__media image-with-text__media--{{ section.settings.height }} global-media-settings{% unless remove_color_classes %} gradient color-{{ section.settings.color_scheme }}{% else %} background-transparent{% endunless %}{% if section.settings.image != blank %} media{% else %} image-with-text__media--placeholder placeholder{% endif %}"
            {% if section.settings.height == 'adapt' and section.settings.image != blank %}
              style="padding-bottom: {{ 1 | divided_by: section.settings.image.aspect_ratio | times: 100 }}%;"
            {% endif %}
          >
            {%- if section.settings.image != blank -%}
              {%- assign widths = '165, 360, 535, 750, 1070, 1500' -%}
              {%- capture sizes -%}
                (min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: 2 }}px,
                (min-width: 750px) calc((100vw - 130px) / 2), calc((100vw - 50px) / 2)
              {%- endcapture -%}
              {{
                section.settings.image
                | image_url: width: 1500
                | image_tag: sizes: sizes, widths: widths, fetchpriority: fetch_priority
              }}
            {%- else -%}
              {{ 'detailed-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>
        </div>
        <div class="image-with-text__text-item grid__item">
          <div
            id="ImageWithText--{{ section.id }}"
            class="image-with-text__content image-with-text__content--{{ section.settings.desktop_content_position }} image-with-text__content--desktop-{{ section.settings.desktop_content_alignment }} image-with-text__content--mobile-{{ section.settings.mobile_content_alignment }} image-with-text__content--{{ section.settings.height }} content-container{% unless remove_color_classes %} gradient color-{{ section.settings.color_scheme }}{% else %} background-transparent{% endunless %}"
          >
            {%- for block in section.blocks -%}
              {% case block.type %}
                {%- when 'heading' -%}
                  <h2 class="image-with-text__heading inline-richtext {{ block.settings.heading_size }}" {{ block.shopify_attributes }}>
                    {{ block.settings.heading }}
                  </h2>
                {%- when 'caption' -%}
                  <p class="image-with-text__text image-with-text__text--caption {{ block.settings.text_style }}" {{ block.shopify_attributes }}>
                    {{ block.settings.caption | escape }}
                  </p>
                {%- when 'text' -%}
                  <div class="image-with-text__text rte" {{ block.shopify_attributes }}>
                    {{ block.settings.text }}
                  </div>
                {%- when 'button' -%}
                  {%- if block.settings.button_label != blank -%}
                    {%- if block.settings.product != blank -%}
                      {%- assign product = block.settings.product -%}
                      <div class="quick-add-button-wrapper">
                        <button
                          type="button"
                          class="button button--full-width {% if block.settings.button_style_secondary %}button--secondary{% else %}button--primary{% endif %} js-add-to-cart"
                          data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                          {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
                        >
                          <span class="js-button-text">
                            {%- if product.selected_or_first_available_variant.available -%}
                              {{ block.settings.button_label | escape }}
                            {%- else -%}
                              {{ 'products.product.sold_out' | t }}
                            {%- endif -%}
                          </span>
                          <div class="loading-overlay__spinner hidden">
                            <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                              <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                            </svg>
                          </div>
                        </button>
                      </div>
                    {%- else -%}
                      <a
                        {% if block.settings.button_link == blank %}
                          role="link" aria-disabled="true"
                        {% else %}
                          href="{{ block.settings.button_link }}"
                        {% endif %}
                        class="button{% if block.settings.button_style_secondary %} button--secondary{% else %} button--primary{% endif %}"
                        {{ block.shopify_attributes }}
                      >
                        {{ block.settings.button_label | escape }}
                      </a>
                    {%- endif -%}
                  {%- endif -%}
              {%- endcase -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('.js-add-to-cart');

    buttons.forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation(); // Stop event bubbling

        const variantId = this.getAttribute('data-variant-id');
        if (!variantId) return;

        // Show loading state
        this.setAttribute('disabled', true);
        this.classList.add('loading');
        const spinner = this.querySelector('.loading-overlay__spinner');
        const textSpan = this.querySelector('.js-button-text');
        
        if(spinner) spinner.classList.remove('hidden');
        if(textSpan) textSpan.classList.add('hidden');

        // Prepare form data for adding to cart
        const formData = {
          'items': [{
            'id': variantId,
            'quantity': 1
          }],
          'sections': 'cart-drawer,cart-icon-bubble' // Ask for these sections to be returned
        };

        fetch(window.Shopify.routes.root + 'cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
          // Check for error in response data (e.g. sold out)
          if (data.status) {
             alert(data.description || 'Error adding to cart');
             return;
          }

          // SUCCESS: Open the Cart Drawer
          const cartDrawer = document.querySelector('cart-drawer');
          const cartNotification = document.querySelector('cart-notification');

          if (cartDrawer) {
             // 1. Update the drawer content with the HTML returned by the API
             cartDrawer.renderContents(data);
             // 2. Add class to open the drawer
             // NOTE: Depending on theme version, this might be 'active' or attribute 'open'
             if (cartDrawer.classList.contains('is-empty')) cartDrawer.classList.remove('is-empty');
             // Try standard methods to open
             document.body.classList.add('overflow-hidden');
             cartDrawer.classList.add('active'); // Common in Dawn
             cartDrawer.setAttribute('open', ''); // Common in newer Dawn
          } else if (cartNotification) {
             cartNotification.renderContents(data);
             cartNotification.classList.add('active');
             cartNotification.setAttribute('open', '');
          } else {
             // Fallback: Redirect to cart if no drawer found
             window.location.href = '/cart';
          }
        })
        .catch((error) => {
          console.error('Error:', error);
          // Only alert if it's a real error, not a false positive syntax error from empty response
          if (error.message !== 'Unexpected end of JSON input') {
             alert('Error adding to cart. Please try again.');
          }
        })
        .finally(() => {
          // Remove loading state
          this.removeAttribute('disabled');
          this.classList.remove('loading');
          if(spinner) spinner.classList.add('hidden');
          if(textSpan) textSpan.classList.remove('hidden');
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "t:sections.image-with-text.name",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    { "type": "image_picker", "id": "image", "label": "t:sections.image-with-text.settings.image.label" },
    { "type": "select", "id": "height", "options": [ { "value": "adapt", "label": "t:sections.image-with-text.settings.height.options__1.label" }, { "value": "small", "label": "t:sections.image-with-text.settings.height.options__2.label" }, { "value": "medium", "label": "t:sections.image-with-text.settings.height.options__3.label" }, { "value": "large", "label": "t:sections.image-with-text.settings.height.options__4.label" } ], "default": "adapt", "label": "t:sections.image-with-text.settings.height.label" },
    { "type": "select", "id": "image_fit", "options": [ { "value": "cover", "label": "t:sections.image-with-text.settings.image_fit.options__1.label" }, { "value": "contain", "label": "t:sections.image-with-text.settings.image_fit.options__2.label" } ], "default": "cover", "label": "t:sections.image-with-text.settings.image_fit.label", "info": "t:sections.image-with-text.settings.image_fit.info" },
    { "type": "select", "id": "desktop_image_width", "options": [ { "value": "small", "label": "t:sections.image-with-text.settings.desktop_image_width.options__1.label" }, { "value": "medium", "label": "t:sections.image-with-text.settings.desktop_image_width.options__2.label" }, { "value": "large", "label": "t:sections.image-with-text.settings.desktop_image_width.options__3.label" } ], "default": "medium", "label": "t:sections.image-with-text.settings.desktop_image_width.label" },
    { "type": "select", "id": "layout", "options": [ { "value": "image_first", "label": "t:sections.image-with-text.settings.layout.options__1.label" }, { "value": "text_first", "label": "t:sections.image-with-text.settings.layout.options__2.label" } ], "default": "image_first", "label": "t:sections.image-with-text.settings.layout.label" },
    { "type": "select", "id": "desktop_content_position", "options": [ { "value": "top", "label": "t:sections.image-with-text.settings.desktop_content_position.options__1.label" }, { "value": "middle", "label": "t:sections.image-with-text.settings.desktop_content_position.options__2.label" }, { "value": "bottom", "label": "t:sections.image-with-text.settings.desktop_content_position.options__3.label" } ], "default": "top", "label": "t:sections.image-with-text.settings.desktop_content_position.label" },
    { "type": "select", "id": "desktop_content_alignment", "options": [ { "value": "left", "label": "t:sections.image-with-text.settings.desktop_content_alignment.options__1.label" }, { "value": "center", "label": "t:sections.image-with-text.settings.desktop_content_alignment.options__2.label" }, { "value": "right", "label": "t:sections.image-with-text.settings.desktop_content_alignment.options__3.label" } ], "default": "left", "label": "t:sections.image-with-text.settings.desktop_content_alignment.label" },
    { "type": "select", "id": "content_layout", "options": [ { "value": "no-overlap", "label": "t:sections.image-with-text.settings.content_layout.options__1.label" }, { "value": "overlap", "label": "t:sections.image-with-text.settings.content_layout.options__2.label" } ], "default": "no-overlap", "label": "t:sections.image-with-text.settings.content_layout.label" },
    { "type": "checkbox", "id": "enable_border_box", "label": "Show border box", "default": false },
    { "type": "color_scheme", "id": "section_color_scheme", "label": "t:sections.all.colors.label", "default": "scheme-1" },
    { "type": "color_scheme", "id": "color_scheme", "label": "t:sections.multirow.settings.container_color_scheme.label", "default": "scheme-1" },
    { "type": "header", "content": "Mobile layout" },
    { "type": "select", "id": "mobile_content_alignment", "options": [ { "value": "left", "label": "t:sections.image-with-text.settings.mobile_content_alignment.options__1.label" }, { "value": "center", "label": "t:sections.image-with-text.settings.mobile_content_alignment.options__2.label" }, { "value": "right", "label": "t:sections.image-with-text.settings.mobile_content_alignment.options__3.label" } ], "default": "left", "label": "t:sections.image-with-text.settings.mobile_content_alignment.label" },
    { "type": "header", "content": "t:sections.all.padding.section_padding_heading" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "t:sections.all.padding.padding_top", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "t:sections.all.padding.padding_bottom", "default": 36 }
  ],
  "blocks": [
    { "type": "heading", "name": "t:sections.image-with-text.blocks.heading.name", "limit": 1, "settings": [ { "type": "inline_richtext", "id": "heading", "default": "t:sections.image-with-text.blocks.heading.settings.heading.default", "label": "t:sections.image-with-text.blocks.heading.settings.heading.label" }, { "type": "select", "id": "heading_size", "options": [ { "value": "h2", "label": "t:sections.all.heading_size.options__1.label" }, { "value": "h1", "label": "t:sections.all.heading_size.options__2.label" }, { "value": "h0", "label": "t:sections.all.heading_size.options__3.label" } ], "default": "h1", "label": "t:sections.all.heading_size.label" } ] },
    { "type": "caption", "name": "t:sections.image-with-text.blocks.caption.name", "limit": 1, "settings": [ { "type": "text", "id": "caption", "default": "t:sections.image-with-text.blocks.caption.settings.text.default", "label": "t:sections.image-with-text.blocks.caption.settings.text.label" }, { "type": "select", "id": "text_style", "options": [ { "value": "subtitle", "label": "t:sections.image-with-text.blocks.caption.settings.text_style.options__1.label" }, { "value": "caption-with-letter-spacing", "label": "t:sections.image-with-text.blocks.caption.settings.text_style.options__2.label" } ], "default": "caption-with-letter-spacing", "label": "t:sections.image-with-text.blocks.caption.settings.text_style.label" } ] },
    { "type": "text", "name": "t:sections.image-with-text.blocks.text.name", "limit": 1, "settings": [ { "type": "richtext", "id": "text", "default": "t:sections.image-with-text.blocks.text.settings.text.default", "label": "t:sections.image-with-text.blocks.text.settings.text.label" } ] },
    {
      "type": "button",
      "name": "t:sections.image-with-text.blocks.button.name",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "button_label", "default": "t:sections.image-with-text.blocks.button.settings.button_label.default", "label": "t:sections.image-with-text.blocks.button.settings.button_label.label" },
        { "type": "url", "id": "button_link", "label": "t:sections.image-with-text.blocks.button.settings.button_link.label" },
        { "type": "checkbox", "id": "button_style_secondary", "default": false, "label": "t:sections.image-with-text.blocks.button.settings.outline_button.label" },
        {
          "type": "header",
          "content": "Buy Button"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product",
          "info": "Selecting a product will convert the button into an 'Add to cart' button."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.image-with-text.presets.name",
      "blocks": [
        { "type": "heading" },
        { "type": "text" },
        { "type": "button" }
      ]
    }
  ]
}
{% endschema %}
